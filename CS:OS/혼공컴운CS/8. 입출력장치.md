# 8. 입출력장치
# 학습내용
- 장치 컨트롤러
- 장지 드라이버
- 다양한 입출력 방법
  - 프로그램 입출력
  - 메모리 맵 입출력, 고립형 입출력
  - 인터럽트 기반 입출력
  - DMA 입출력
  - 입출력 버스


## 장치 컨트롤러

입출력장치는 종류가 너무 많아 규격화하기 어렵다.
CPU와 메모리의 데이터 전송률은 높아도 입출력장치의 데이터 전송률은 낮다.

➡️ 이러한 문제를 해결하기 위해 `장치 컨트롤러` 하드웨어를 사용하게 됨!

### 장치 컨트롤러의 역할
- CPU와 입출력장치 간의 통신 중개
- 오류 검출
- 데이터 버퍼링

**데이터 버퍼링?** 전송률이 높은 장치와 낮은 장치간의 전송률을 비슷하게 맞춰주는 기능. `버퍼`라는 임시저장공간에 저장하여 맞춰준다.

### 장치 컨트롤러 내부에 있는 레지스터
- 데이터 레지스터 : 데이터를 저장하는 레지스터, 버퍼의 역할을 함
- 상태/제어 레지스터 : 입출력할 준비가 되어있는지, 완료되엇는지, 오류는 없는지 등등 상태 정보를 저장하고 수행할 내용에 대한 제어 정보와 명령을 담고있다.

---

## 장치 드라이버
장치 컨트롤러의 동작을 감지하고 제어하는 역할
장치 컨트롤러 - 컴퓨터내부 정보를 주고받게 해주는 **프로그램**

- 실제 장치 드라이버를 인식하고 실행하는 주체는 OS(운영체제)이다.

---

## 다양한 입출력 방법

### 프로그램 입출력

1. CPU가 하드디스크 컨트롤러의 `제어 레지스터`에 쓰기 명령을 한다. 즉, 메모리에 저장된 정보를 하드디스크에 백업한다.
2. 하드디스크 컨트롤러가 하드디스크 상태를 확인한다. `상태 레지스터`에 상태 입력
3. CPU가 주기적으로 하드디스크 컨트롤러의 `상태 레지스터`를 읽고 `데이터 레지스터`에 저장할 데이터를 쓴다.

이러한 3단계를 반복적으로 진행한다.

그렇다면, 다양한 입출력 장치 컨트롤러속 레지스터를 알 수 있을까?
  ➡️ **메모리 맵 입출력, 고립형 입출력**
  
### 메모리 맵 입출력, 고립형 입출력

- 메모리 맵 입출력 : 메모리 주소공간과 입출력 주소공간을 하나의 주소공간으로 인식한다. 그렇기 때문에 공간이 축소되고, 둘의 명령어가 같다는 특징이 있다.
- 고립형 입출력 : 서로 주소공간을 분리해서 인식한다. 입출력 전용 명령어가 따로 있고 공간이 축소되지 않는 특징이 있다.

### 인터럽트 기반 입출력
인터럽트를 통해 CPU의 일을 줄여준다고 생각하면 된다!
인터럽트 서비스 루틴을 통해 프로그램이 실행중일 때 인터럽트를 요청하면 그 인터럽트를 처리한다.

예를들어, A, B 서비스 루틴이 있는데 A가 B보다 우선순위가 높다면, A먼저 처리하고 B를 처리하면 되고, 반대라면 A를 처리하다가도 멈추고 B를 먼저 처리한다.

- PIC (프로그래머블 인터럽트 컨트롤러) : 여러 핀이 부착되어 있어 이를 통해 CPU에 하드웨어 인터럽트 요청을 보내게 된다.
- NMI : 인터럽트 비트를 비활성화 해도 무시할 수 없는 인터럽트
   - PIC에는 NMI 요청을 보내지는 않고, NMI는 주로 CPU에 다이렉트로 보내지게 된다.

### DMA 입출력 
```
입출력장치와 메모리 간의 데이터 이동은 CPU가 주도하고, 이동하는 데이터도 반드시 CPU를 거치게 된다.
```

그렇다면, CPU는 너무 많은 일을 하는거 아닌가? 이것을 해결하기 위해 `DMA` 입출력 방식이 나왔다.

- CPU를 거치지 않고 입출력장치가 메모리에 직접 접근하는 기능이다.
- DMA 컨트롤러 하드웨어가 필요하다.

### DMA 입출력 과정
1. CPU -> DMA 컨트롤러 명령
2. DMA -> 입출력 작업 수행, 필요한 경우 메모리에 직접 접근
3. DMA -> CPU에 작업 종료 인터럽트 요청

이때, DMA와 CPU는 같은 시스템 버스를 사용하게 되는데, DMA가 시스템 버스를 사용할 수 있는 방법 2가지가 있다. (Cycle stealing)
- CPU가 사용하지 않을 때 사용
- CPU에게 허락을 받고 사용 

### 입출력 버스
수많은 장치 컨트롤러가 시스템 버스가 직접 연결되어 있다면, DMA가 불필요하게 여러번 시스템 버스를 사용하게 된다. 시스템 버스는 공유자원이기 때문에 그러면 좋지 않다!! 그래서 장치 컨트롤러는 `입출력 버스`에 연결되어 있다.

- 입출력 버스의 종류 : PCI 버스, PCIe버스 등
