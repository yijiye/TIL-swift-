# ë©”ëª¨ë¦¬êµ¬ì¡°
- ì£¼ê¸°ì–µì¥ì¹˜(RAM) ì— Code, Data, Heap, Stack ì˜ì—­ì´ ì¡´ì¬, ì´ ì˜ì—­ì„ ë‚˜ëˆ ì£¼ëŠ” ê²ƒì€ ìš´ì˜ì²´ì œ (OS)ê°€ í•œë‹¤.

## Code ì˜ì—­
- ê°œë°œìê°€ ì‘ì„±í•œ ì†ŒìŠ¤ì½”ë“œê°€ ì»´í“¨í„° ì–¸ì–´ (ì´ì§„ë²•ìœ¼ë¡œ ì´ë£¨ì–´ì§„) í˜•íƒœë¡œ ì €ì¥ë˜ëŠ” ê³µê°„
- ì»´íŒŒì¼ íƒ€ì„ì— ê²°ì •ë˜ê³ , ì¤‘ê°„ì— ì½”ë“œê°€ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ `Read-Only` í˜•íƒœë¡œ ì €ì¥ëœë‹¤.

## Data ì˜ì—­
- ì „ì—­ë³€ìˆ˜, static ë³€ìˆ˜ê°€ ì €ì¥ë˜ëŠ” ê³µê°„
- í”„ë¡œê·¸ë¨ ì‹œì‘ê³¼ ë™ì‹œì— í• ë‹¹ë˜ê³  ì¢…ë£Œë˜ì–´ì•¼ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œëœë‹¤.
- ì‹¤í–‰ ë„ì¤‘ ê°’ì´ ë³€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ `Read-Wirte`ë¡œ ì§€ì •ëœë‹¤.

> staticì˜ ê²½ìš° lazyê°€ ë””í´íŠ¸ì´ë¯€ë¡œ í•´ë‹¹ê°’ì— ì ‘ê·¼í• ë•Œ í• ë‹¹ë˜ì–´ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°ˆ ìˆ˜ ìˆìŒ! *ì¶”ê°€í•™ìŠµí•„ìš”*

## Heap ì˜ì—­
- ê°œë°œìê°€ í• ë‹¹/í•´ì œí•˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­
- ì‚¬ìš©í•˜ê³  ë‚œ í›„ì—ëŠ” ë°˜ë“œì‹œ ë©”ëª¨ë¦¬ë¥¼ í•´ì œì‹œì¼œì¤˜ì•¼ í•œë‹¤.
- í•´ì œë˜ì§€ ì•Šìœ¼ë©´ ë©”ëª¨ë¦¬ëˆ„ìˆ˜ê°€ ë°œìƒ
- `ëŸ°íƒ€ì„`ì‹œ ê²°ì •ë˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ì˜ í¬ê¸°ê°€ í™•ì‹¤í•˜ì§€ ì•Šì„ë•Œ ì‚¬ìš©
- í´ë˜ìŠ¤, í´ë¡œì € ê°™ì€ ì°¸ì¡°íƒ€ì…ì˜ ê°’ì€ í™ì— í• ë‹¹ëœë‹¤.

## Stack ì˜ì—­
- í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ì§€ì—­ë³€ìˆ˜, ë§¤ê°œë³€ìˆ˜, return ê°’ ë“±ì´ ì €ì¥ëœë‹¤.
- í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ ìë™ìœ¼ë¡œ í•´ì œëœë‹¤.
- `ì»´íŒŒì¼ íƒ€ì„`ì— ê²°ì •ë˜ê¸° ë•Œë¬¸ì— ë¬´í•œíˆ í• ë‹¹í•  ìˆ˜ ì—†ë‹¤.
- ì„ì‹œ ë©”ëª¨ë¦¬ ì˜ì—­!
- CPUê°€ ìŠ¤íƒ ë©”ëª¨ë¦¬ë¥¼ êµ¬ì„±í•˜ë¯€ë¡œ ì†ë„ê°€ ë¹ ë¥´ë‹¤.

```swift
func plus(_ a: Int, _ b: Int) -> Int {
    let result = a + b
    return result
}
```
- a, b, return Int ëŠ” stack ì˜ì—­ì— ì €ì¥
- ì§€ì—­ìƒìˆ˜ result ëŠ” stack ì˜ì—­ì— ì €ì¥

## ê¶ê¸ˆí•œ ì 
- swiftì˜ ë©”ëª¨ë¦¬ ì˜ì—­ì€ 64bit ì•„í‚¤í…ì²˜ì— ë”°ë¼ ê²°ì •ëœë‹¤.
- String, Array, DictionaryëŠ” ê¸°ë³¸ ë°ì´í„° íƒ€ì…ì´ì§€ë§Œ heap ì˜ì—­ì— í• ë‹¹ëœë‹¤.
   - ì™œ? ëŸ°íƒ€ì„ë•Œ ë°ì´í„°ì˜ í¬ê¸°ê°€ ì •í•´ì§€ì§€ ì•Šì•„ì„œ ë™ì ì˜ì—­ì¸ heapì— ì €ì¥ë˜ëŠ” ê²ƒ!
- ë©”ëª¨ë¦¬ì˜ í¬ê¸°ë¥¼ ê²°ì •í•˜ëŠ” ìš”ì¸ì€?
   - ìš´ì˜ì²´ì œì¸ CPUê°€ ê²°ì •í•œë‹¤.
- ìŠ¤íƒì˜ì—­ì— ìˆëŠ” ë©”ëª¨ë¦¬ëŠ” ì–´ë–»ê²Œ í•´ì œë ê¹Œ?
   - ì‚¬ìš©ì´ ì™„ë£Œë ë•Œë§ˆë‹¤ í•˜ë‚˜ì”© pop ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì•±ì´ ì¢…ë£Œë ë•Œ í•œë²ˆì— pop ëœë‹¤.
   - ì™œ? ë‹¤ì‹œ ì‚¬ìš©ë  ìˆ˜ ë„ ìˆê¸° ë•Œë¬¸ì— ì¼ì„ ì—¬ëŸ¬ë²ˆ í•˜ì§€ ì•Šê²Œ í•˜ë ¤ê³ !
- ë°˜ë³µë¬¸ì´ ì €ì¥ë˜ëŠ” ê³µê°„ì€?
   - ì½”ë“œ ì˜ì—­ì— ì €ì¥ë˜ë¯€ë¡œ ì‚¬ìš©ì´ ì¢…ë£Œë˜ê³  ë‹¤ì‹œ ë°˜ë³µì´ ê°€ëŠ¥í•˜ë‹¤.
 
---

# ARC

## Q : ARCëŠ” ë¬´ì—‡ì¸ê°€?

- swiftì—ì„œ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš° ìë™ì ìœ¼ë¡œ reference countë¥¼ ê³„ì‚°í•´ì£¼ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ í´ë˜ìŠ¤ íƒ€ì…ì—ì„œë§Œ ì ìš©ëœë‹¤.
- í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì„ë•Œ ë©”ëª¨ë¦¬ë¥¼ ìë™ìœ¼ë¡œ í•´ì œí•œë‹¤.
- Heap ì˜ì—­ì„ ê´€ë¦¬í•œë‹¤.
- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ì£¼ì†Œê°’ì€ ìŠ¤íƒì— í• ë‹¹ë˜ê³  ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ëŠ” í™ ì˜ì—­ì— í• ë‹¹ëœë‹¤.
```swift
class Person {
    var name: String?
    init(name: String) {
        self.name = name
    }
}

let riji = Person(name: "ë¦¬ì§€") // riji ëŠ” ìŠ¤íƒì— í• ë‹¹ë˜ê³  ì‹¤ì œ Personì´ë€ ê°’ì€ í™ ì˜ì—­ì— í• ë‹¹
let riji2 = riji // Personì„ ê°€ë¥´í‚¤ê³  ìˆìŒ
```

### RC íŠ¹ì§•
- í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•  ìˆ˜ ìˆì–´ íš¨ìœ¨ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
- `ì»´íŒŒì¼ íƒ€ì„`ì— ìë™ìœ¼ë¡œ retain, release (MRCì—ì„œ ì‚¬ìš©í–ˆë˜) ë¥¼ ì ì ˆí•œ ìœ„ì¹˜ì— ì‚½ì…í•˜ê³  ì‚½ì…ëœ ì½”ë“œëŠ” `ëŸ°íƒ€ì„`ì— ì‹¤í–‰ëœë‹¤.
- ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ëŠ” ìì‹ ì˜ RC ê°’ì„ ê°€ì§€ê³  ìˆë‹¤.
- RCê°€ ì¦ê°€í•˜ëŠ” ê²½ìš°?
   - init()ì´ ë ë•Œ, ì¦‰ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í• ë•Œ
   - í”„ë¡œí¼í‹°, ë³€ìˆ˜, ìƒìˆ˜ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ í• ë‹¹í• ë•Œ
   - ë©”ì„œë“œ ë‚´ë¶€ì˜ ì§€ì—­ë³€ìˆ˜, ìƒìˆ˜ì— í• ë‹¹í• ë•Œ

- ARC ë©”ì»¤ë‹ˆì¦˜ì€ `Swift Runtime` ì´ë¼ëŠ” `library`ì— êµ¬í˜„ë˜ì–´ ìˆë‹¤.
   - swift Runtimeì€ ë™ì  í• ë‹¹ë˜ëŠ” ëª¨ë“  objectë¥¼ HeapObjectë¼ëŠ” structìœ¼ë¡œ í‘œí˜„
   - HeapObjectì—ì„œëŠ” swiftì—ì„œ ê°ì²´ë¥¼ êµ¬ì„±í•˜ëŠ” ëª¨ë“  ë°ì´í„° (RC, type metadata)ë¥¼ í¬í•¨
   - classì— ëŒ€í•œ HeapObjectë¥¼ í†µí•´ RCë¥¼ ê´€ë¦¬í•œë‹¤.

(HeapObjectì— ëŒ€í•œ ê³µë¶€ê°€ í•„ìš”í•˜ë‹¤!!!)

### RC ì¹´ìš´íŠ¸ í•´ë³´ê¸°
- ì•„ë˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•´ì„œ ì—°ìŠµí•˜ë‹ˆ ì´í•´ê°€ ì˜ë˜ëŠ” ê²ƒ ê°™ë‹¤!!
[ì†Œë“¤ì´ë¸”ë¡œê·¸](https://babbab2.tistory.com/26)

## Q : ARC ì´ì „ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ëŠ” ì–´ë• ì„ê¹Œ?

- ê³¼ê±° Obj-C ì—ì„œëŠ” `MRC (Manula reference counting)` ë°©ë²•ìœ¼ë¡œ retain, relase, autorelease ë“±ì„ í†µí•´ ìˆ˜ë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ í•´ì™”ë‹¤.
- ê°œë°œìê°€ ì§ì ‘ retain, release ì˜ ìœ„ì¹˜ë¥¼ ì¡ì•„ì£¼ë˜ ê²ƒì„ compile time ì— ìë™ìœ¼ë¡œ retain, release ë¥¼ ì ì ˆí•œ ìœ„ì¹˜ì— ì‚½ì…í•´ ì£¼ëŠ”ê²ƒì´ë‹¤.

## Q : ARCë¥¼ ì´í•´í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ë¬´ì—‡ì´ ìˆì„ê¹Œ?

- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´!
[ë‚´ê°€ê³µë¶€í•œê°•ìˆœì°¸](https://github.com/yijiye/TIL-swift-/blob/main/Memory/ARC%20ê°•í•œìˆœí™˜ì°¸ì¡°.md)

## Q : ì–¸ì œ êµ¬ì¡°ì²´ë¥¼ ì„ íƒí•˜ê³  ì–¸ì œ í´ë˜ìŠ¤ë¥¼ ì„ íƒí•´ì•¼í• ê¹Œ?

swiftì—ì„œëŠ” struct ì‚¬ìš©ì„ ê¶Œì¥í•˜ë©° ë””í´íŠ¸ì´ë‹¤
ê·¸ë˜ì„œ í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ structì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. [ê³µì‹ë¬¸ì„œ](https://developer.apple.com/documentation/swift/choosing-between-structures-and-classes)
- ì¸ìŠ¤í„´ìŠ¤ëŠ” ë°”ë€Œì§€ ì•Šê³  ë‚´ë¶€ í”„ë¡œí¼í‹°ë§Œì„ ë³€ê²½í•  ìƒí™©ì´ ìˆì„ ë•Œ
- ë‹¤ë¥¸ê³³ì—ì„œ ë™ì¼ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•˜ê³  ì‹¶ì„ ê²½ìš° - (ex. ì‹±ê¸€í†¤)
- ìƒì†ì´ í•„ìš”í•œ ê²½ìš°

---

## ê¶ê¸ˆí•œ ì  
- ê³µì‹ë¬¸ì„œì—ì„œ í´ë˜ìŠ¤ íƒ€ì…ì— ëŒ€í•´ ARCë¥¼ ì ìš©í•œë‹¤ê³  í–ˆëŠ”ë° ê·¸ëŸ¼ ê°™ì€ ê°’ íƒ€ì…ì€ í´ë¡œì €ëŠ” ì–´ë–»ê²Œ ê´€ë¦¬í• ê¹Œ? 

### í´ë¡œì €ì˜ ê°’ ìº¡ì³
- í´ë¡œì €ëŠ” ê°’ì„ ìº¡ì³í•  ë•Œ, Value/Reference íƒ€ì…ì— ê´€ê³„ì—†ì´ Reference Captureë¥¼ í•œë‹¤.
```swift
func doSomething() {
    var message = "Hi"
 
    //í´ë¡œì € ë²”ìœ„ ì‹œì‘
    
    var num = 10
    let closure = { print(num) }
 
    //í´ë¡œì € ë²”ìœ„ ë
    
    print(message)
}
```
- í´ë¡œì €ëŠ” ì™¸ë¶€ ë³€ìˆ˜ì¸ `num`ì„ ë³€ìˆ˜ë¡œ ì‚¬ìš©(print)í•˜ì—¬ numì˜ ê°’ì„ í´ë¡œì € ë‚´ë¶€ë¡œ ì €ì¥ => `numì˜ ê°’ì´ ìº¡ì³`ë˜ì—ˆë‹¤ê³  í‘œí˜„í•¨
- ì´ë•Œ `message`ë¼ëŠ” ë³€ìˆ˜ëŠ” í´ë¡œì € ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ìº¡ì³ë˜ì§€ ì•Šì•˜ìŒ

- `num`ì€ `Int` íƒ€ì…ì˜ `êµ¬ì¡°ì²´` í˜•ì‹ì´ì `value` íƒ€ì…ì´ë¯€ë¡œ ê°’ì„ ë³µì‚¬í•´ì„œ ì €ì¥í•˜ëŠ”ê²Œ ì¼ë°˜ì ì¸ë°, í´ë¡œì €ëŠ” `Value/Reference íƒ€ì…ì— ê´€ê³„ì—†ì´` ìº¡ì³í•˜ëŠ” ê°’ë“¤ì„ ì°¸ì¡°í•œë‹¤.

### í´ë¡œì €ì˜ ìº¡ì³ ë¦¬ìŠ¤íŠ¸
`let closure = { [num, num2] in`
- í´ë¡œì €ì˜ ì‹œì‘ { ë°”ë¡œì•ì— [] í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ìº¡ì³í•  ë©¤ë²„ë¥¼ ë‚˜ì—´í•œ í›„ inì„ ë¶™ì—¬ì£¼ëŠ” í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### í´ë¡œì €ì™€ ARC
```swift
class Human {
    var name = ""
    lazy var getName: () -> String = {
        return self.name
    }
    
    init(name: String) {
        self.name = name
    }
 
    deinit {
        print("Human Deinit!")
    }
}
```
- `getName` ì´ë€ í´ë¡œì €ë¥¼ í˜¸ì¶œí•˜ë©´ Heapì— í• ë‹¹ë˜ë©° ì´ í´ë¡œì €ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.
- `self.name` ì„ í†µí•´ Human ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¡œí¼í‹°ì— ì ‘ê·¼í•˜ê³  ìˆëŠ”ë° í´ë¡œì €ê°€ ê°’ ìº¡ì³ë¥¼ í• ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ strong ìœ¼ë¡œ ìº¡ì³ë¥¼ í•˜ë¯€ë¡œ Human ì´ë€ ì¸ìŠ¤í„´ìŠ¤ì˜ RCë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.
- Human ì¸ìŠ¤í„´ìŠ¤ëŠ” í´ë¡œì €ë¥¼ ì°¸ì¡°í•˜ê³ , í´ë¡œì €ëŠ” Human ì¸ìŠ¤í„´ìŠ¤ì˜ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ê³  ìˆì–´ ì„œë¡œ ê°•í•œìˆœí™˜ ì°¸ì¡°ê°€ ë°œìƒ!

### í´ë¡œì €ì˜ ê°•ìˆœì°¸ í•´ê²°ë²•
- weak & unowned + capture lists ë¥¼ ì´ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
- selfì— ëŒ€í•œ ì°¸ì¡°ë¥¼ í´ë¡œì € ìº¡ì³ ë¦¬ìŠ¤íŠ¸ë¥¼ í†µí•´ weak, unownedë¡œ ìº¡ì³í•˜ë©´ ëœë‹¤.
```swift
class Human {
    lazy var getName: () -> String? = { [weak self] in
        return self?.name
    }
}
```

### í´ë¡œì € ê²°ë¡ 
- ARC ê³µì‹ë¬¸ì„œì—ì„œ í´ë˜ìŠ¤ íƒ€ì…ì— í•œì •ë˜ì–´ìˆë‹¤ê³  í•˜ì—¬ í´ë¡œì €ê°€ ê¶ê¸ˆí•´ì¡ŒëŠ”ë° ë‚´ìš©ì´ ë„ˆë¬´ ì–´ë ¤ì›Œì„œ ì¶”ê°€ ê³µë¶€ê°€ ë” í•„ìš”í•´ ë³´ì¸ë‹¤ ğŸ¥²
ì˜¤ëŠ˜ì€ ê°„ëµí•˜ê²Œ í´ë¡œì €ë„ ARCì™€ ì—°ê´€ë˜ì–´ ìˆê³  í´ë¡œì €ì˜ ê²½ìš°ëŠ” ê°’ ìº¡ì²˜ë¥¼ í†µí•´ RCê°€ ì¦ê°€í•˜ê³  ì´ë¥¼ í•´ê²°í•˜ë ¤ë©´ í´ë¡œì €ì˜ ìº¡ì³ë¦¬ìŠ¤íŠ¸ë¥¼ weak / unownedë¡œ í•´ì£¼ë©´ RCê°€ ì¦ê°€í•˜ì§€ ì•Šì•„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥´ ë°©ì§€í•  ìˆ˜ ìˆë‹¤ëŠ” ë‚´ìš©ê¹Œì§€ ì•Œì•„ë³¸ ê²ƒìœ¼ë¡œ ë§Œì¡±í•œë‹¤,,
[ì°¸ê³ ë¸”ë¡œê·¸](https://babbab2.tistory.com/83)

----
## ì°¸ê³ 
- https://sujinnaljin.medium.com/ios-arc-ë¿Œì‹œê¸°-9b3e5dc23814
- https://babbab2.tistory.com/25
- https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html
- https://babbab2.tistory.com/83
- https://developer.apple.com/documentation/swift/choosing-between-structures-and-classes
